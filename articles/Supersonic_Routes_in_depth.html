<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="himach">
<title>Advanced Supersonic Routing • himach</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Advanced Supersonic Routing">
<meta property="og:description" content="himach">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">himach</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.3.2.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/Supersonic_Routes.html">Introduction to Supersonic Routing</a>
    <a class="dropdown-item" href="../articles/Supersonic_Routes_in_depth.html">Advanced Supersonic Routing</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/david6marsh/himach/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Advanced Supersonic Routing</h1>
                        <h4 data-toc-skip class="author">David
Marsh</h4>
            
            <h4 data-toc-skip class="date">2023-10-13</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/david6marsh/himach/blob/HEAD/vignettes/Supersonic_Routes_in_depth.Rmd" class="external-link"><code>vignettes/Supersonic_Routes_in_depth.Rmd</code></a></small>
      <div class="d-none name"><code>Supersonic_Routes_in_depth.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p><a href="Supersonic_Routes.html">Supersonic Routes</a> provides a
quick end-to-end introduction to using the <code>himach</code> package
and is the place to start. This vignette provides advice on more
advanced use, explaining details that the introduction skates over.</p>
<p>Much of this vignette is optional or for occasional use, but the
advice on saving and reading the cache is likely to be
<em>essential</em> for a speedy workflow, so that is described
first.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#the libraries needed for the vignette are</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/david6marsh/himach" class="external-link">himach</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span>, quietly <span class="op">=</span> <span class="cn">TRUE</span>, warn.conflicts <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Linking to GEOS 3.10.2, GDAL 3.4.1, PROJ 8.2.1; sf_use_s2() is TRUE</span></span>
<span></span>
<span><span class="co"># and we'll load a full set of test data</span></span>
<span><span class="va">NZ_coast</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/hm_get_test.html">hm_get_test</a></span><span class="op">(</span><span class="st">"coast"</span><span class="op">)</span></span>
<span><span class="va">NZ_buffer30</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/hm_get_test.html">hm_get_test</a></span><span class="op">(</span><span class="st">"buffer"</span><span class="op">)</span></span>
<span><span class="va">NZ_Buller_buffer40</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/hm_get_test.html">hm_get_test</a></span><span class="op">(</span><span class="st">"nofly"</span><span class="op">)</span></span>
<span><span class="va">NZ_grid</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/hm_get_test.html">hm_get_test</a></span><span class="op">(</span><span class="st">"grid"</span><span class="op">)</span></span>
<span><span class="va">NZ_routes</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/hm_get_test.html">hm_get_test</a></span><span class="op">(</span><span class="st">"route"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="cache">Cache Management<a class="anchor" aria-label="anchor" href="#cache"></a>
</h2>
<p><code>himach</code> uses caching to speed things up. Legs are cached
in <code>route_cache</code> and arrival-departure links to airports are
cached in <code>star_cache</code> (STAR is short for standard arrival
route, its counterpart being SID the standard instrument departure).</p>
<p>You will want to save and load the cache (meaning the combination of
<code>route_cache</code> and <code>star_cache</code>) as part of your
standard workflow. Quite where you save it is up to you, but a set of
routes is sensitive to (a) the route grid on which it is calculated (b)
the list of aircraft used, and their performance. The saving function
<code>hm_save_cache</code> forces you to refer to these two datasets,
and uses metadata from them in the file name for the cache.</p>
<p>If you change either of these, then you can use
<code><a href="../reference/hm_clean_cache.html">hm_clean_cache()</a></code> to empty the cache. You will also note
that if you run <code>find_routes</code> and the map has changed, or
<code>findToCToD</code> and the map or aircraft have changed, then the
cache will be cleared automatically.</p>
<p>For the vignette, we save to a temporary directory. You really don’t
want to do this in practice ;-)</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/hm_clean_cache.html">hm_clean_cache</a></span><span class="op">(</span><span class="op">)</span> <span class="co">#start without cache</span></span>
<span></span>
<span><span class="co"># need to load some of the built-in data for this example</span></span>
<span><span class="va">aircraft</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_aircraft.html">make_aircraft</a></span><span class="op">(</span>warn <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">airports</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_airports.html">make_airports</a></span><span class="op">(</span>crs <span class="op">=</span> <span class="va">crs_Pacific</span><span class="op">)</span></span>
<span><span class="co">#&gt; Using default airport data: airportr::airport.</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span><span class="st">"quiet"</span><span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="co"># for a little reporting</span></span>
<span><span class="co"># how long does it take with an empty cache?</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span></span>
<span>  <span class="va">routes</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/find_route.html">find_route</a></span><span class="op">(</span><span class="va">aircraft</span><span class="op">[</span><span class="fl">1</span>, <span class="op">]</span>,</span>
<span>                       <span class="fu"><a href="../reference/make_AP2.html">make_AP2</a></span><span class="op">(</span><span class="st">"NZAA"</span>, <span class="st">"NZDN"</span>, <span class="va">airports</span><span class="op">)</span>,</span>
<span>                       fat_map <span class="op">=</span> <span class="va">NZ_buffer30</span>,</span>
<span>                       route_grid <span class="op">=</span> <span class="va">NZ_grid</span>,</span>
<span>                       ap_loc <span class="op">=</span> <span class="va">airports</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; The legacy packages maptools, rgdal, and rgeos, underpinning the sp package,</span></span>
<span><span class="co">#&gt; which was just loaded, were retired in October 2023.</span></span>
<span><span class="co">#&gt; Please refer to R-spatial evolution reports for details, especially</span></span>
<span><span class="co">#&gt; https://r-spatial.org/r/2023/05/15/evolution4.html.</span></span>
<span><span class="co">#&gt; It may be desirable to make the sf package available;</span></span>
<span><span class="co">#&gt; package maintainers should consider adding sf to Suggests:.</span></span>
<span><span class="co">#&gt; Route:-NZAA&lt;&gt;NZDN----</span></span>
<span><span class="co">#&gt; Leg: NZAA&lt;&gt;NZDN Aircraft: SST M2.2</span></span>
<span><span class="co">#&gt;  Cut envelope from lattice: 0.1</span></span>
<span><span class="co">#&gt;  Calculated phase changes</span></span>
<span><span class="co">#&gt;  Done recursion</span></span>
<span><span class="co">#&gt;  Checking Shortcuts</span></span>
<span><span class="co">#&gt;    user  system elapsed </span></span>
<span><span class="co">#&gt;   1.304   0.080   1.385</span></span>
<span></span>
<span><span class="co"># test saving of cache to a disposable directory</span></span>
<span><span class="va">tmp_dir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co"># for convenience, hm_save_cache gives the full name, including path</span></span>
<span><span class="va">full_filename</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/hm_save_cache.html">hm_save_cache</a></span><span class="op">(</span><span class="st">"test_v"</span>, <span class="va">NZ_grid</span>, <span class="va">aircraft</span>, path <span class="op">=</span> <span class="va">tmp_dir</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#empty cache - just to demonstrate the re-loading</span></span>
<span><span class="co"># this isn't part of your normal workflow!</span></span>
<span><span class="fu"><a href="../reference/hm_clean_cache.html">hm_clean_cache</a></span><span class="op">(</span><span class="op">)</span> </span>
<span><span class="co"># but normally a session will begin with loading a cache like this</span></span>
<span><span class="fu"><a href="../reference/hm_load_cache.html">hm_load_cache</a></span><span class="op">(</span><span class="va">full_filename</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># how long does it take with a cache?</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span></span>
<span>  <span class="va">routes</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/find_route.html">find_route</a></span><span class="op">(</span><span class="va">aircraft</span><span class="op">[</span><span class="fl">1</span>, <span class="op">]</span>,</span>
<span>                       <span class="fu"><a href="../reference/make_AP2.html">make_AP2</a></span><span class="op">(</span><span class="st">"NZAA"</span>, <span class="st">"NZDN"</span>, <span class="va">airports</span><span class="op">)</span>,</span>
<span>                       fat_map <span class="op">=</span> <span class="va">NZ_buffer30</span>,</span>
<span>                       route_grid <span class="op">=</span> <span class="va">NZ_grid</span>,</span>
<span>                       ap_loc <span class="op">=</span> <span class="va">airports</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Route:-NZAA&lt;&gt;NZDN----</span></span>
<span><span class="co">#&gt;    user  system elapsed </span></span>
<span><span class="co">#&gt;   0.032   0.000   0.032</span></span>
<span></span>
<span></span>
<span><span class="co"># if you want to see a map</span></span>
<span><span class="co"># map_routes(NZ_coast, routes, crs_Pacific, fat_map = NZ_buffer30, simplify_km = 2)</span></span></code></pre></div>
<p>The cache just works invisibly in the background - you will notice it
speeds up finding of routes no end: in that example, from 1.5s (user) to
0.04s (user) on my machine. In particular, it helps with refuelling,
because the <code>route_cache</code> quickly remembers the routes from
major hub airports to the main refuelling points, so they don’t need to
be calculated again.</p>
<p>Incidentally, if you add a new refuelling point, then the cache
remains <em>valid</em> because only <strong>legs are cached, not
routes</strong>. With a new refuelling point, <code>find_route</code>
will check both old legs and new (to the new refuelling points), gaining
where the legs are cached, before selecting the best combination of legs
to make the route.</p>
<div class="section level3">
<h3 id="cache-housekeeping-advanced">Cache housekeeping (advanced)<a class="anchor" aria-label="anchor" href="#cache-housekeeping-advanced"></a>
</h3>
<p>There may be times when you have built a large cache, of several
thousand routes for a handful of aircraft. If you want to make a change
to the performance of one aircraft, say, you either need to
<code><a href="../reference/hm_clean_cache.html">hm_clean_cache()</a></code> and start everything again, or do a bit of
housekeeping. The same is true if an airport location needs correcting:
ideally we delete all references to just that airport.</p>
<p>If you’re not comfortable housekeeping, then just let
<code>himach</code> run overnight to redo the whole thing.</p>
<p>Housekeeping involves loading the cache manually, with
<code>load</code>. It contains two environments <code>route_cache</code>
and <code>star_cache</code> (segments to and from airports). The items
in the cache are named with strings which capture a number of run
parameters, including the aircraft ID. So we identify items for
deletion, and <code>rm</code> them. Then save the cache manually with
<code>save</code>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># for this example, add a second route to the cache</span></span>
<span><span class="va">routes</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/find_route.html">find_route</a></span><span class="op">(</span><span class="va">aircraft</span><span class="op">[</span><span class="fl">2</span>, <span class="op">]</span>,</span>
<span>                       <span class="fu"><a href="../reference/make_AP2.html">make_AP2</a></span><span class="op">(</span><span class="st">"NZAA"</span>, <span class="st">"NZDN"</span>, <span class="va">airports</span><span class="op">)</span>,</span>
<span>                       fat_map <span class="op">=</span> <span class="va">NZ_buffer30</span>,</span>
<span>                       route_grid <span class="op">=</span> <span class="va">NZ_grid</span>,</span>
<span>                       ap_loc <span class="op">=</span> <span class="va">airports</span><span class="op">)</span></span>
<span><span class="co">#&gt; Route:-NZAA&lt;&gt;NZDN----</span></span>
<span><span class="co">#&gt; Leg: NZAA&lt;&gt;NZDN Aircraft: SST M1.6 8.8</span></span>
<span><span class="co">#&gt;  Cut envelope from lattice: 0.1</span></span>
<span><span class="co">#&gt;  Calculated phase changes</span></span>
<span><span class="co">#&gt;  Done recursion</span></span>
<span><span class="co">#&gt;  Checking Shortcuts</span></span>
<span><span class="co"># save the cache, which has NZAA-NZDN for 2 aircraft now</span></span>
<span><span class="fu"><a href="../reference/hm_save_cache.html">hm_save_cache</a></span><span class="op">(</span><span class="st">"test_v"</span>, <span class="va">NZ_grid</span>, <span class="va">aircraft</span>, path <span class="op">=</span> <span class="va">tmp_dir</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#now do housekeeping</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span><span class="va">full_filename</span><span class="op">)</span> <span class="co"># filename from the previous chunk</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/ls.html" class="external-link">ls</a></span><span class="op">(</span><span class="va">route_cache</span><span class="op">)</span> <span class="co"># show the contents, just for information</span></span>
<span><span class="co">#&gt; [1] "M16_9-NZAA-NZDN--TRUE-TRUE-NA-TRUE-100-12"</span></span>
<span><span class="co">#&gt; [2] "M22-NZAA-NZDN--TRUE-TRUE-NA-TRUE-100-12"</span></span>
<span><span class="co"># we want to delete instances of aircraft with ID that includes 'M22'</span></span>
<span><span class="va">z</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html" class="external-link">ls</a></span><span class="op">(</span><span class="va">route_cache</span>, pattern<span class="op">=</span><span class="st">"M22"</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">as.list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">route_cache</span><span class="op">)</span> <span class="co"># before deletion</span></span>
<span><span class="co">#&gt; [1] 2</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rm</span>, <span class="va">z</span>, envir <span class="op">=</span> <span class="va">route_cache</span><span class="op">)</span> <span class="co"># delete the M22 items</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">route_cache</span><span class="op">)</span> <span class="co">#after deletion, 1 less</span></span>
<span><span class="co">#&gt; [1] 1</span></span>
<span><span class="co"># then repeat for star_cache</span></span>
<span><span class="va">z</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html" class="external-link">ls</a></span><span class="op">(</span><span class="va">star_cache</span>, pattern<span class="op">=</span><span class="st">"M22"</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">as.list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">star_cache</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 4</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rm</span>, <span class="va">z</span>, envir <span class="op">=</span> <span class="va">star_cache</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">star_cache</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 2</span></span>
<span><span class="co"># then save the result (you might want to change the filename, or backup the old cache beforehand)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/save.html" class="external-link">save</a></span><span class="op">(</span><span class="st">"route_cache"</span>, <span class="st">"star_cache"</span>, file <span class="op">=</span> <span class="va">full_filename</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="extra-plots">Extra Plots<a class="anchor" aria-label="anchor" href="#extra-plots"></a>
</h2>
<div class="section level3">
<h3 id="route_density">Route density plots<a class="anchor" aria-label="anchor" href="#route_density"></a>
</h3>
<p>The function <code>map_routes</code> does a reasonable job of showing
where the supersonic aircraft will fly, but it has two notable
limitations. Firstly, when you have scores or hundreds of routes, the
overlapping of routes begins to reduce the readability of the map.
Secondly, some routes are likely to be flown more often than others:
Paris-New York once a day, perhaps, while Copenhagen-New York only twice
per week.</p>
<p>In this vignette, we show how to plot the <em>density</em> of routes,
taking into account overlap and flight frequency. While a density map
might serve some needs, a simpler bar chart is a fairly clear way to
summarise total quantity (of flown hours) by, say, latitude, which can
be of interest for atmospheric modelling.</p>
<p>The process is fairly mechanical. We’ll either do a latitude or a
longitude bar chart, using a single function. We assume you’ve
calculated a set of routes, in which you have only one ‘best’ route per
<code>acID</code> and <code>routeID</code> (so have got rid of any
different refuelling options, for example).</p>
<p>The frequency of each is ‘1’ by default. Given the label ‘hours per
week’, this corresponds to 1 flight per week. If you want different
frequencies for each route, you need to pass a dataframe with 3 columns:
identifiers <code>acID</code> and <code>routeID</code>, and a value for
flights per week in <code>flights_w</code> which does not have to be an
integer. See the parameters for how to drop <code>acID</code>, say. If
you want flight hours per year, say, then you need to switch the values
in and name of <code>freq_var</code>.</p>
<p>If you’re running a forecast, you will have different routes and
frequencies in different years and different scenarios. The plot will be
faceted by <code>year</code> and <code>scen_ord</code>. These variables
should also be in your frequency dataset, and for faceting should be
factors or integer. We use <code>scen_ord</code> rather than
<code>scenario</code> to indicate an ordered factor, so that they can
always be plotted in ‘low, base, high’ order rather than
alphabetical.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">hm_latlong_density</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">rt</span>, <span class="co"># route dataset created earlier</span></span>
<span>                               <span class="va">ll</span> <span class="op">=</span> <span class="st">"lat"</span>, <span class="co">#lat or long chart?</span></span>
<span>                               <span class="co"># frequency data, either 1 or</span></span>
<span>                               <span class="co"># dataset with at least 5 columns</span></span>
<span>                               <span class="va">freq</span> <span class="op">=</span> <span class="fl">1</span>, </span>
<span>                               <span class="co"># 2 for joining</span></span>
<span>                               <span class="va">join_var</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"acID"</span>, <span class="st">"routeID"</span><span class="op">)</span>,</span>
<span>                               <span class="co"># 1 for value</span></span>
<span>                               <span class="va">freq_var</span> <span class="op">=</span> <span class="va">flights_w</span>,</span>
<span>                               <span class="va">freq_lab</span> <span class="op">=</span> <span class="st">"Hours per week"</span>,</span>
<span>                               <span class="co"># and 2 for faceting</span></span>
<span>                               <span class="va">facet_rows</span> <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span>, <span class="co">#or use NULL</span></span>
<span>                               <span class="va">facet_cols</span> <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">scen_ord</span>, <span class="va">acID</span><span class="op">)</span>,</span>
<span>                               <span class="co"># other plot configuration elements</span></span>
<span>                               <span class="va">bar_deg</span> <span class="op">=</span> <span class="fl">3</span>, <span class="co"># width of bar plotted in degrees</span></span>
<span>                               <span class="va">resolution_deg</span> <span class="op">=</span> <span class="fl">1</span>, <span class="co"># granularity of analysis, keep small</span></span>
<span>                               <span class="co"># ignore when flights are stationary (refuelling)</span></span>
<span>                               <span class="va">drop_zero</span> <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                               <span class="co"># return a graph, or a set of data</span></span>
<span>                               <span class="va">return_data</span> <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="co"># graph of lat or long?</span></span>
<span>  <span class="va">sel_coord</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">ll</span> <span class="op">|&gt;</span> </span>
<span>                        <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/case.html" class="external-link">str_to_upper</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>                        <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_sub.html" class="external-link">str_sub</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span> <span class="op">==</span> <span class="st">"LA"</span>,</span>
<span>                      <span class="fl">2</span>, <span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="va">coord_label</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">sel_coord</span> <span class="op">==</span> <span class="fl">2</span>, <span class="st">"Latitude (deg)"</span>, <span class="st">"Longitude (deg)"</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">rt</span> <span class="op">&lt;-</span> <span class="va">rt</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="co">#just in case supplied dataset is grouped</span></span>
<span>    <span class="co"># standard route dataset will have all of these</span></span>
<span>    <span class="co"># each row is a great circle segment</span></span>
<span>    <span class="co"># in particular time_h is the flight time in hours for the segment</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">phase</span>, <span class="va">phaseID</span>, <span class="va">gc</span>, <span class="va">acID</span>, <span class="va">routeID</span>, <span class="va">speed_kph</span>, <span class="va">time_h</span>, <span class="va">crow</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>seg <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/row_number.html" class="external-link">row_number</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="co"># note this is ungrouped</span></span>
<span>  <span class="co"># this is a graph of flight time, so ignore time spent on the ground refuelling</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">drop_zero</span><span class="op">)</span> <span class="va">rt</span> <span class="op">&lt;-</span> <span class="va">rt</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">speed_kph</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">is.data.frame</a></span><span class="op">(</span><span class="va">freq</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="co"># zoom in on the variables we need</span></span>
<span>    <span class="va">freq</span> <span class="op">&lt;-</span> <span class="va">freq</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/all_of.html" class="external-link">all_of</a></span><span class="op">(</span><span class="va">join_var</span><span class="op">)</span>, <span class="op">{</span><span class="op">{</span><span class="va">freq_var</span><span class="op">}</span><span class="op">}</span>, <span class="va">scen_ord</span>, <span class="va">year</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="va">rt</span> <span class="op">&lt;-</span> <span class="va">rt</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">inner_join</a></span><span class="op">(</span><span class="va">freq</span>, by <span class="op">=</span> <span class="va">join_var</span>, relationship <span class="op">=</span> <span class="st">"many-to-many"</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="va">rt</span> <span class="op">&lt;-</span> <span class="va">rt</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>flights_w <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span>    <span class="va">facet_rows</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span>    <span class="va">facet_cols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">acID</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="co"># split the great circle arcs into the graph resolution</span></span>
<span>  <span class="va">rt</span> <span class="op">&lt;-</span> <span class="va">rt</span> <span class="op">|&gt;</span></span>
<span>    <span class="co"># ensure fine resolution</span></span>
<span>    <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_unary.html" class="external-link">st_segmentize</a></span><span class="op">(</span><span class="fu">units</span><span class="fu">::</span><span class="fu"><a href="https://r-quantities.github.io/units/reference/units.html" class="external-link">set_units</a></span><span class="op">(</span><span class="va">resolution_deg</span>, <span class="va">degree</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="co"># drop the sf geometry, without dropping the gc column</span></span>
<span>    <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_set_geometry</a></span><span class="op">(</span><span class="st">"crow"</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="co"># we only kept this to sacrifice it here</span></span>
<span>    <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_drop_geometry</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span><span class="op">!</span><span class="va">gc</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="co">#don't want to lose any var in the reframe</span></span>
<span>    <span class="co"># the reframe is to pull out either lat or long coordinate</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/reframe.html" class="external-link">reframe</a></span><span class="op">(</span>coord <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_coordinates.html" class="external-link">st_coordinates</a></span><span class="op">(</span><span class="va">gc</span><span class="op">)</span><span class="op">[</span> , <span class="va">sel_coord</span><span class="op">]</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/all_of.html" class="external-link">any_of</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"seg"</span>, <span class="st">"scen_ord"</span>, <span class="st">"year"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="co"># now keep one entry per segment/resolution</span></span>
<span>    <span class="co"># drop the last row if there's more than one, because we want to count line segments really</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="co">#round to the graph resolution</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>coord <span class="op">=</span> <span class="va">resolution_deg</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">floor</a></span><span class="op">(</span><span class="va">coord</span> <span class="op">/</span> <span class="va">resolution_deg</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="co"># time_h is the flight time in hours for the great circle segment</span></span>
<span>    <span class="co"># now shared, after st_segmentize, amongst n() subsegments</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>time_h <span class="op">=</span> <span class="op">{</span><span class="op">{</span><span class="va">freq_var</span><span class="op">}</span><span class="op">}</span> <span class="op">*</span> <span class="va">time_h</span> <span class="op">/</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>           bar_coord <span class="op">=</span> <span class="va">bar_deg</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">coord</span><span class="op">/</span><span class="va">bar_deg</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># then use geom_bar to add up the times, across all flights</span></span>
<span>  <span class="va">g</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">rt</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">bar_coord</span>,</span>
<span>                      fill <span class="op">=</span> <span class="va">phase</span>,</span>
<span>                      weight <span class="op">=</span> <span class="va">time_h</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_bar</a></span><span class="op">(</span><span class="op">)</span>  <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span>rows <span class="op">=</span> <span class="va">facet_rows</span>, cols <span class="op">=</span> <span class="va">facet_cols</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">freq_lab</span>, x <span class="op">=</span> <span class="va">coord_label</span><span class="op">)</span></span>
<span>  <span class="co"># orient appropriately for long or lat</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">sel_coord</span> <span class="op">==</span> <span class="fl">2</span><span class="op">)</span> <span class="va">g</span> <span class="op">&lt;-</span> <span class="va">g</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_flip.html" class="external-link">coord_flip</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">return_data</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">rt</span><span class="op">)</span> <span class="kw">else</span> <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">g</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>We’ll show an example or two and then explain in a bit more detail
how the graph ends up showing flight hours.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># simple case with default 1 flight/week frequency</span></span>
<span><span class="fu">hm_latlong_density</span><span class="op">(</span><span class="va">NZ_routes</span>, facet_rows <span class="op">=</span> <span class="cn">NULL</span>, facet_cols <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">acID</span><span class="op">)</span>,</span>
<span>                   bar_deg <span class="op">=</span> <span class="fl">0.5</span>, resolution_deg <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span></span></code></pre></div>
<p><img src="Supersonic_Routes_in_depth_files/figure-html/density_examples-1.png" width="672"></p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># make up a forecast of frequencies</span></span>
<span><span class="va">freq_fc</span> <span class="op">&lt;-</span> <span class="va">NZ_routes</span> <span class="op">|&gt;</span> </span>
<span>  <span class="co"># get the ac &amp; routes we need the forecast for</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">acID</span>, <span class="va">routeID</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_drop_geometry</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="co"># convert from sf to tibble</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="co"># add in some forecast years</span></span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/expand.html" class="external-link">crossing</a></span><span class="op">(</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>year <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2040L</span>, <span class="fl">2050L</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="co"># add in some scenarios</span></span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/expand.html" class="external-link">crossing</a></span><span class="op">(</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>scen_ord <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">ordered</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"low"</span>, <span class="st">"base"</span>, <span class="st">"high"</span><span class="op">)</span>, </span>
<span>                                            levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"low"</span>, <span class="st">"base"</span>, <span class="st">"high"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="co"># and some flights per week (that don't make a lot of sense)</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">year</span>, <span class="va">scen_ord</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>flights_w <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/row_number.html" class="external-link">row_number</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> </span>
<span>  </span>
<span><span class="fu">hm_latlong_density</span><span class="op">(</span><span class="va">NZ_routes</span>, ll <span class="op">=</span> <span class="st">"long"</span>, </span>
<span>                   freq <span class="op">=</span> <span class="va">freq_fc</span>,</span>
<span>                   bar_deg <span class="op">=</span> <span class="fl">0.5</span>, resolution_deg <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span></span></code></pre></div>
<p><img src="Supersonic_Routes_in_depth_files/figure-html/density_examples-2.png" width="672"></p>
<p>These illustrate strong (mode) peak of flight demand around 41
degrees South and 174 degrees East.</p>
<p>To get the flight hours per week we use the <code>time_h</code>
property in the routes data. This gives the duration, in hours, to fly
the great circle arc in this row of the data. For graphing purposes, we
split each great circle row into multiple sub-arcs using
<code>reframe</code>, which is like <code>summarise</code> but you can
end up with more rows than you started with. We aim for significantly
smaller sub-arcs than the bar bin width (a sub-arc is just an arc). We
share <code>time_h</code> equally amongst those sub-arcs and extract the
start (lat or long) coordinate of the sub-arc. Multiply by the flight
frequency to get hours per week for each sub-arc. The
<code>geom_bar</code> then just adds up the hours per week for all the
sub-arcs (starting) in that bin. All this is summarised in the comments
in the function.</p>
</div>
</div>
<div class="section level2">
<h2 id="route-finding-details">Route-finding details<a class="anchor" aria-label="anchor" href="#route-finding-details"></a>
</h2>
<div class="section level3">
<h3 id="no-fly-zones">No-fly zones<a class="anchor" aria-label="anchor" href="#no-fly-zones"></a>
</h3>
<p>It is not unusual for parts of the airspace to be closed, or be
considered unsafe for flying. <code>himach</code> allows regions to be
marked as ‘avoid’. They will not feature in the grid, so routes will
avoid them, with one exception: an arrival or departure airport can be
inside a no-fly zone, as long as at least one connection point to the
grid is outside. So they might more precisely be called ‘no-overfly’
zones.</p>
<p>A no-fly zone is prepared in the same way as a map of land. If
specific countries are to be avoided, this is where having a country
name in the geographic data comes in handy.</p>
<p>One essential item is the <code>avoid</code> attribute of the no-fly
zone. This is used to distinguish sets of legs with different, or no,
no-fly zone. Set
<code>attr(your_avoid_map, "avoid") &lt;- "your summary of that avoid map"</code>
which will (a) remind you what was used (b) tell <code>himach</code> to
recalculate all legs that have not already been calculated with that
value of <code>avoid</code>. If you were to add an avoid area for North
Korean airspace, say, then in reality North Atlantic routes are not
affected, but currently <code>himach</code> plays safe and assumes that
they are.</p>
<p>In this example, no offence is intended to the citizens of Buller
District of New Zealand; it is a convenient example for showing how
routes are forced to change when airspace is unavailable.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># using your own shp file </span></span>
<span><span class="co"># NZ_Buller &lt;- sf::read_sf("...../territorial-authority-2020-clipped-generalised.shp") %&gt;% </span></span>
<span><span class="co">#     filter(TA2020_V_1 == "Buller District")</span></span>
<span><span class="co"># NZ_Buller_u &lt;- sf::st_union(sf::st_simplify(NZ_Buller, dTolerance = 1000))</span></span>
<span><span class="co"># NZ_Buller_buffer50 &lt;- sf::st_union(sf::st_buffer(NZ_Buller_u, 50 * 1000))</span></span>
<span><span class="co"># attr(NZ_Buller_buffer50, "avoid") &lt;- "Buller+50km"</span></span>
<span><span class="co"># the quicker version, using a built-in no fly zone</span></span>
<span></span>
<span><span class="co"># this uses data as in the previous code chunk</span></span>
<span><span class="va">aircraft</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_aircraft.html">make_aircraft</a></span><span class="op">(</span>warn <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">airports</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_airports.html">make_airports</a></span><span class="op">(</span>crs <span class="op">=</span> <span class="va">crs_Pacific</span><span class="op">)</span></span>
<span><span class="co">#&gt; Using default airport data: airportr::airport.</span></span>
<span></span>
<span><span class="co"># run the same route, but with the avoid region</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span><span class="st">"quiet"</span><span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="co">#just the progress bar</span></span>
<span><span class="va">ac</span> <span class="op">&lt;-</span> <span class="va">aircraft</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">4</span><span class="op">)</span>, <span class="op">]</span><span class="op">$</span><span class="va">id</span></span>
<span><span class="va">routes</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/find_routes.html">find_routes</a></span><span class="op">(</span><span class="va">ac</span>, </span>
<span>                      <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>ADEP <span class="op">=</span> <span class="st">"NZAA"</span>, ADES <span class="op">=</span> <span class="st">"NZDN"</span><span class="op">)</span>,</span>
<span>                      <span class="va">aircraft</span>, <span class="va">airports</span>,</span>
<span>                      fat_map <span class="op">=</span> <span class="va">NZ_buffer30</span>, </span>
<span>                      route_grid <span class="op">=</span> <span class="va">NZ_grid</span>,</span>
<span>                      cf_subsonic <span class="op">=</span> <span class="va">aircraft</span><span class="op">[</span><span class="fl">3</span>,<span class="op">]</span>,</span>
<span>                      avoid <span class="op">=</span> <span class="va">NZ_Buller_buffer40</span><span class="op">)</span></span>
<span><span class="co">#&gt; Route:-NZAA&lt;&gt;NZDN----</span></span>
<span><span class="co">#&gt; Leg: NZAA&lt;&gt;NZDN Aircraft: SST M2.2</span></span>
<span><span class="co">#&gt;  Cut envelope from lattice: 0.1</span></span>
<span><span class="co">#&gt;  Calculated phase changes</span></span>
<span><span class="co">#&gt;  Done recursion</span></span>
<span><span class="co">#&gt;  Checking Shortcuts</span></span>
<span><span class="co">#&gt;  Adding subsonic, without range bounds.</span></span>
<span><span class="co">#&gt; Leg: NZAA&lt;&gt;NZDN Aircraft: 777-300ER</span></span>
<span><span class="co">#&gt;  Calculated phase changes</span></span>
<span><span class="co">#&gt;  Done recursion</span></span>
<span><span class="co">#&gt;  Checking Shortcuts</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Route:-NZAA&lt;&gt;NZDN----</span></span>
<span><span class="co">#&gt;  Too far for one leg.</span></span>
<span><span class="co">#&gt;  Adding subsonic, without range bounds.</span></span>
<span><span class="co">#&gt; </span></span>
<span></span>
<span><span class="co">#this shows versions of the legs with and without no-fly</span></span>
<span><span class="co"># ls(route_cache, pattern = "NZCH", envir = .hm_cache)</span></span>
<span></span>
<span><span class="co"># create route summary</span></span>
<span><span class="va">rtes</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/summarise_routes.html">summarise_routes</a></span><span class="op">(</span><span class="va">routes</span>, <span class="va">airports</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># draw a basic map</span></span>
<span><span class="fu"><a href="../reference/map_routes.html">map_routes</a></span><span class="op">(</span><span class="va">NZ_coast</span>, <span class="va">routes</span>, <span class="va">crs_Pacific</span>, fat_map <span class="op">=</span> <span class="va">NZ_buffer30</span>,</span>
<span>          avoid_map <span class="op">=</span> <span class="va">NZ_Buller_buffer40</span>,</span>
<span>          simplify_km <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="Supersonic_Routes_in_depth_files/figure-html/createBuffer-1.png" width="700"></p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="../reference/map_routes.html">map_routes</a></span><span class="op">(</span><span class="va">NZ_coast</span>, <span class="va">routes</span>, show_route <span class="op">=</span> <span class="st">"aircraft"</span>,</span>
<span>           crs <span class="op">=</span> <span class="va">crs_Pacific</span>, fat_map <span class="op">=</span> <span class="va">NZ_buffer30</span>,</span>
<span>          avoid_map <span class="op">=</span> <span class="va">NZ_Buller_buffer40</span>,</span>
<span>          simplify_km <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="Supersonic_Routes_in_depth_files/figure-html/createBuffer-2.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="why-do-i-have-na-routes">Why do I have <code>NA</code> routes?<a class="anchor" aria-label="anchor" href="#why-do-i-have-na-routes"></a>
</h3>
<p>After a call to <code>find_routes</code>, the output can have
<code>NA</code> entries in some columns for some routes. There are two
reasons for this:</p>
<ul>
<li>This airport pair is too far for a single leg for this aircraft. If
you have given a list of possible refuelling airports
<code>refuel = xxx</code>, then you will find other entries for the same
<code>routeID</code> (eg “EGLL&lt;&gt;KSFO”) but with different
<code>fullRouteID</code> (eg “EGLL&lt;&gt;PANC&lt;&gt;KSFO”) showing a
good route including refuelling.</li>
<li>One of the airports may be unreachable because all of the
top-of-climb (=top-of-descent) points are within an avoid airspace. You
will have received a warning message at the end of the run of
<code>find_routes</code>.</li>
</ul>
<p>So these appear when the specified route is not possible.</p>
</div>
<div class="section level3">
<h3 id="bufferaccuracy">Too many ocean routes: Buffer widths and projections<a class="anchor" aria-label="anchor" href="#bufferaccuracy"></a>
</h3>
<p>Above 60 or 70 (North or South), the approximations used by the
<code>st_buffer</code> function begin to show signs of exceeding their
limits. In particular, if you’re adding a 50km coastal buffer, for
example, there are separations between Canadian islands which are just
under 100km. Borden and Ellef Ringnes are examples. A buffer generated
by <code>st_buffer</code> shows the strait between them as open water,
where it should be closed.</p>
<p>This can lead to over-optimistic routings: supersonic where they
should not be.</p>
<p>The solution is to use the links from <code>sf</code> to the
<code>s2</code> package which come in more recent versions of the
<code>sf</code> package. This does require you to use quite a high value
for the <code>max_cells</code> parameter of
<code><a href="https://r-spatial.github.io/s2/reference/s2_boundary.html" class="external-link">s2::s2_buffer_cells</a></code>.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gr</span> <span class="op">&lt;-</span> <span class="fu">s2</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/s2/reference/s2_data_tbl_countries.html" class="external-link">s2_data_countries</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Greenland"</span>, <span class="st">"Canada"</span>, <span class="st">"Iceland"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">gr_buffer_s2</span> <span class="op">&lt;-</span> <span class="fu">s2</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/s2/reference/s2_boundary.html" class="external-link">s2_buffer_cells</a></span><span class="op">(</span><span class="va">gr</span>, distance <span class="op">=</span> <span class="fl">50000</span>, max_cells <span class="op">=</span> <span class="fl">20000</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>   <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sfc.html" class="external-link">st_as_sfc</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">m_s2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform</a></span><span class="op">(</span><span class="va">gr_buffer_s2</span>, <span class="va">crs_Atlantic</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"grey40"</span><span class="op">)</span> <span class="op">+</span></span>
<span>   <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sfc.html" class="external-link">st_as_sfc</a></span><span class="op">(</span><span class="va">gr</span><span class="op">)</span>, <span class="va">crs_Atlantic</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/s2.html" class="external-link">sf_use_s2</a></span><span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="co"># to be sure</span></span>
<span><span class="va">gr_transf</span> <span class="op">&lt;-</span> <span class="va">gr</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>   <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sfc.html" class="external-link">st_as_sfc</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>   <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform</a></span><span class="op">(</span><span class="va">crs_Atlantic</span><span class="op">)</span></span>
<span><span class="va">gr_t_buffer</span> <span class="op">&lt;-</span> <span class="va">gr_transf</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>   <span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_unary.html" class="external-link">st_buffer</a></span><span class="op">(</span>dist <span class="op">=</span> <span class="fl">50000</span><span class="op">)</span></span>
<span><span class="va">m_old</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">gr_t_buffer</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"grey40"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">gr_transf</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">cowplot</span><span class="fu">::</span><span class="fu"><a href="https://wilkelab.org/cowplot/reference/plot_grid.html" class="external-link">plot_grid</a></span><span class="op">(</span><span class="va">m_old</span>, <span class="va">m_s2</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"bad"</span>, <span class="st">"good"</span><span class="op">)</span>,</span>
<span>                   ncol <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="buffer_example.png" alt=""><p class="caption">Incorrect and Correct Buffer</p>
</div>
<p>In fact, the problem of finding too many apparently over-ocean routes
is broader than this. The other main contributor to this is missing
islands from the map. See the comments <a href="Supersonic_Routes.html#maps">in the first vignette</a>.</p>
<p>An example of this is in the same place. Some maps omit small islands
(well, larger ones like Killniq down to tiny ones like Goodwin Island)
at the mouth of the Hudson Strait. This affects the apparent width of
the opening. Given the islands, and a 50km buffer, the Strait is
<em>not</em> open as the next example shows.</p>
<p>This uses a non-CRAN, but public package of hi-resolution maps,
<code>rnaturalearthhires</code>. If you don’t want to load this package,
just note the results shown in the figure.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/s2.html" class="external-link">sf_use_s2</a></span><span class="op">(</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">hires</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span><span class="fu">rnaturalearthhires</span><span class="fu">::</span><span class="va">countries10</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">NAME</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Greenland"</span>, <span class="st">"Canada"</span>, <span class="st">"Iceland"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">hires_buffer_s2</span> <span class="op">&lt;-</span> <span class="fu">s2</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/s2/reference/s2_boundary.html" class="external-link">s2_buffer_cells</a></span><span class="op">(</span><span class="va">hires</span>, distance <span class="op">=</span> <span class="fl">50000</span>, max_cells <span class="op">=</span> <span class="fl">20000</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>   <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sfc.html" class="external-link">st_as_sfc</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">m_hires</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform</a></span><span class="op">(</span><span class="va">hires_buffer_s2</span>, <span class="va">crs_Atlantic</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"grey40"</span><span class="op">)</span> <span class="op">+</span></span>
<span>   <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform</a></span><span class="op">(</span><span class="va">hires</span>, <span class="va">crs_Atlantic</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">cowplot</span><span class="fu">::</span><span class="fu"><a href="https://wilkelab.org/cowplot/reference/plot_grid.html" class="external-link">plot_grid</a></span><span class="op">(</span><span class="va">m_s2</span>, <span class="va">m_hires</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"good"</span>, <span class="st">"better"</span><span class="op">)</span>,</span>
<span>                   ncol <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="buffer_island_example.png" alt=""><p class="caption">Correct Buffer and with Better with More Islands</p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="why-do-i-need-a-coordinate-reference-system">Why do I need a coordinate reference system?<a class="anchor" aria-label="anchor" href="#why-do-i-need-a-coordinate-reference-system"></a>
</h2>
<p>There are a number of place in the vignettes, eg making an airport
dataset, where we have shown the use of a parameter to specify a
coordinate reference system. <code>himach</code> has recently
transitioned to using spherical geometry directly using the
<code>s2</code> package, both directly and through the <code>sf</code>
package. Before <code>s2</code> was available in <code>sf</code> there
was a constant need to align the coordinate reference systems of objects
before combining them.</p>
<p>Now, in theory, all geometrical operations use spherical geometry, so
a coordinate reference system should only be needed when you plot a map.
At that point, the coordinate reference system is saying how to move
from spherical coordinates to a flat projection. Four basic projections
are supplied <code>crs_Atlantic</code>, <code>crs_Pacific</code>,
<code>crs_North</code> and <code>crs_South</code> which you can use in
<code>map_routes</code> to get the right map for your particular set of
routes. You can create others as shown in the vignette.</p>
<p>We will remove remaining references to coordinate reference systems
during route creation in later versions of <code>himach</code>.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by David Marsh, EUROCONTROL.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
